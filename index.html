<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Negative Viewer</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      position: absolute;
      padding: 32px;
      margin: 0;
      gap: 16px;
      background: #fff;
      color: #111;
      transition: background 0.2s, color 0.2s;
    }

    #vid {
      width: 100%;
      height: 100%;
    }

    #tools {
      display: flex;
      gap: 16px;
    }

    #player {
      overflow: hidden;
      width: 100%;
      flex: 1 0 auto;
      border-radius: 8px;
      border: 1px dotted black;
      height: 0px;
    }

    /* Dark mode styles */
    body.dark-mode {
      background: #181a1b;
      color: #eee;
    }
    body.dark-mode #player {
      border: 1px dotted #888;
    }
    body.dark-mode button {
      background: #222;
      color: #eee;
      border: 1px solid #444;
    }

    @media (prefers-color-scheme: dark) {
      body:not(.light-mode):not(.dark-mode) {
        background: #181a1b;
        color: #eee;
      }
      body:not(.light-mode):not(.dark-mode) #player {
        border: 1px dotted #888;
      }
      body:not(.light-mode):not(.dark-mode) button {
        background: #222;
        color: #eee;
        border: 1px solid #444;
      }
    }
  </style>
</head>

<body>
  <div id="player">
    <video id="vid"></video>
  </div>
  <div id="tools">
    <button id="but">Open WebCam</button>
    <button id="butInv" onclick="document.getElementById('vid').style.filter = 'invert(0%)';">Normal</button>
    <button id="butInv" onclick="document.getElementById('vid').style.filter = 'invert(100%)';">Invert</button>
    <button id="capture">Capture Image</button>
    <button id="toggle-dark">ðŸŒ™ Toggle Dark Mode</button>
  </div>
  <canvas id="canvas" style="display:none;"></canvas>
</body>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    let but = document.getElementById("but");
    let video = document.getElementById("vid");
    let captureButton = document.getElementById("capture");
    let canvas = document.getElementById("canvas");
    let mediaDevices = navigator.mediaDevices;
    vid.muted = true;

    // Dark mode toggle logic
    const body = document.body;
    const toggleDark = document.getElementById("toggle-dark");

    // Apply saved preference or system preference
    function applyTheme() {
      const saved = localStorage.getItem("theme");
      body.classList.remove("dark-mode", "light-mode");
      if (saved === "dark") {
        body.classList.add("dark-mode");
      } else if (saved === "light") {
        body.classList.add("light-mode");
      }
      // If no saved preference, system preference via media query applies
    }
    applyTheme();

    toggleDark.addEventListener("click", () => {
      const isDark = body.classList.contains("dark-mode");
      if (isDark) {
        localStorage.setItem("theme", "light");
      } else {
        localStorage.setItem("theme", "dark");
      }
      applyTheme();
    });

    // Optional: Listen for system changes if no manual override
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (!localStorage.getItem("theme")) applyTheme();
    });

    but.addEventListener("click", () => {
      mediaDevices
        .getUserMedia({
          audio: true
        })
        .then((stream) => {
          video.srcObject = stream;
          video.addEventListener("loadedmetadata", () => {
            video.play();
          });
        })
        .catch(alert);
    });

    captureButton.addEventListener("click", () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      let context = canvas.getContext("2d");

      context.filter = getComputedStyle(video).filter;

      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      let dataURL = canvas.toDataURL("image/png");
      let link = document.createElement("a");
      link.href = dataURL;
      link.download = `Capture ${new Date().toLocaleString()}.png`;
      link.click();
    });
  });
</script>

</html>
